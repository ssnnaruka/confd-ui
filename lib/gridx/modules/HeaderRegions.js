//>>built
define("gridx/modules/HeaderRegions","dojo/_base/declare dojo/_base/Deferred dojo/_base/array dojo/query dojo/dom-construct dojo/dom-class dojo/dom-style dojo/keys dojo/_base/event ../core/_Module".split(" "),function(q,t,k,g,r,h,s,e,l,p){return p.register(q(p,{name:"headerRegions",forced:["header"],constructor:function(){this._regions=[]},load:function(){this.refresh();this._initFocus();this.aspect(this.grid.header,"onRender","refresh");this.loaded.callback()},add:function(a,b,c,f){this._regions.push({c:a,
p:b||0,f:!f,n:{}});c||this.refresh()},refresh:function(){var a=this,b=a.grid,c=a._regionNodes=[],f=a._regions;f.length&&(k.forEach(a._regionCnnts||[],function(b){b.remove();a._cnnts.splice(k.indexOf(a._cnnts,b),1)}),a._regionCnnts=[],f.sort(function(a,b){return b.p-a.p}),g(".gridxCell",b.header.domNode).forEach(function(d){h.remove(d,"gridxCellRegion");var e=d.getAttribute("colid"),l=b.column(e,1),m=[];k.forEach(f,function(b){var c=b.n[e];if(!c&&(c=b.n[e]=b.c(l)))h.add(c,"gridxHeaderRegion"),b.f&&
(h.add(c,"gridxHeaderRegionFocusable"),c.setAttribute("tabindex",-1),a.connect(c,"onblur","_onRegionBlur"));c&&(r.place(c,d,"first"),b.f&&m.push(c))});if(m.length){var n=g(".gridxSortNode",d)[0];c.push(n);n.setAttribute("tabindex",-1);a._regionCnnts.push(a.connect(n,"onblur","_onRegionBlur"))}else c.push(d),h.add(d,"gridxCellRegion"),a._regionCnnts.push(a.connect(d,"onblur","_onRegionBlur"));c.push.apply(c,m)}),c[a._curRegionIdx]||(a._curRegionIdx=0))},_onRegionBlur:function(a){a=this.grid.header.domNode;
g(".gridxHeaderRegionFocus",a).removeClass("gridxHeaderRegionFocus");h.remove(a,"gridxHeaderFocus")},_initFocus:function(){var a=this.grid;a.focus.registerArea({name:"header",priority:0,focusNode:a.header.domNode,scope:this,doFocus:this._doFocus,onFocus:this._onFocus,connects:[this.aspect(a,"onHeaderKeyDown","_onKey")]})},_doFocus:function(a){this._focusRegion(this._regionNodes[this._curRegionIdx]);return!0},_onFocus:function(a){a=a.target;var b=this.grid.header.domNode,c=0>k.indexOf(this._regionNodes,
a)?g(a,b).closest(".gridxSortNode")[0]:a,c=c||g(a,b).closest(".gridxHeaderRegion")[0];this._focusRegion(c);return c},_focusRegion:function(a){var b=this,c=b.grid;if(a&&!b._lock){b._lock=1;var f=c.header.domNode,d=g(a).closest(".gridxCell",f)[0];b._curRegionIdx=k.indexOf(b._regionNodes,a);try{a.focus()}catch(e){}setTimeout(function(){g(".gridxHeaderRegionFocus",f).removeClass("gridxHeaderRegionFocus");h.add(d,"gridxHeaderRegionFocus");h.add(f,"gridxHeaderFocus");a.focus();c.hScroller&&c.hScroller.scrollToColumn(d.getAttribute("colid"));
b._lock=0},0)}},_onKey:function(a){if(!this.grid._isCtrlKey(a)&&!a.shiftKey&&!a.altKey){var b=this.grid.isLeftToRight(),c=b?e.LEFT_ARROW:e.RIGHT_ARROW;a.keyCode==(b?e.RIGHT_ARROW:e.LEFT_ARROW)?(this._moveFocus(1),l.stop(a)):a.keyCode==c&&(this._moveFocus(-1),l.stop(a))}},_moveFocus:function(a){for(var b=this._curRegionIdx+a,c=this._regionNodes;c[b]&&"none"==s.get(c[b],"display");)b+=a;c[b]&&this._focusRegion(c[b])}}))});
//# sourceMappingURL=HeaderRegions.js.map