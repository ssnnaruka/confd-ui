//>>built
define("gridx/modules/ColumnResizer","dojo/_base/declare dojo/_base/window dojo/_base/event dojo/dom dojo/dom-style dojo/dom-class dojo/dom-construct dojo/dom-geometry dojo/keys ../support/query dojo/_base/sniff ../core/_Module".split(" "),function(u,e,v,r,s,p,w,h,l,n,x,y){return u(y,{name:"columnResizer",load:function(){var a=this.grid;this.batchConnect([a.header.domNode,"onmousemove","_mousemove"],[a,"onHeaderMouseOut","_mouseout"],[a,"onHeaderMouseDown","_mousedown",this,this.name],[a,"onHeaderKeyDown",
"_keydown"],[e.doc,"onmousemove","_updateResizer"],[e.doc,"onmouseup","_mouseup"]);this.loaded.callback()},columnMixin:{setWidth:function(a){this.grid.columnResizer.setWidth(this.id,a)}},minWidth:20,detectWidth:5,step:2,setWidth:function(a,b){var c=this.grid,d=c._columnsById[a];if(d){var k=c.header.getHeaderNode(a),g=k.style,e=s.get(k,"width"),t=this.arg("minWidth"),f=h.getPadExtents(k),m=f.l+f.r,f=c._columns;b=parseInt(b,10);b<t&&(b=t);g.width=b+"px";g.minWidth=b+"px";g.maxWidth=b+"px";b=k.clientWidth-
m;g.width=b+"px";g.minWidth=b+"px";g.maxWidth=b+"px";d.width=b+"px";d=0;for(k=f.length;d<k;++d)f[d].declaredWidth=f[d].width;n('[colid\x3d"'+c._escapeId(a)+'"]',c.bodyNode).forEach(function(a){a=a.style;a.width=b+"px";a.minWidth=b+"px";a.maxWidth=b+"px"});c.body.onRender();c.hLayout.reLayout();c.vLayout.reLayout();this.onResize(a,b,e)}},onResize:function(){},_mousemove:function(a){var b=this;if(!b._resizing&&!b._ismousedown){var c=b.arg("detectWidth"),d=b.grid,k=d.isLeftToRight(),g=e.body(),q=d._eventFlags;
n(".gridxCell",d.header.innerNode).some(function(e){var f=h.position(e),m=k?f.x+f.w:f.x;e.getAttribute("colid");if(m-c<=a.clientX&&m+c>=a.clientX){var l=(m=n(a._target||a.target).closest("td",d.header.innerNode)[0])&&h.position(m);if(m&&(a.clientX<=l.x+c||a.clientX>=l.x+l.w-c))return p.add(g,"gridxColumnResizing"),b._targetCell=e,b._cellPos=f,q.onHeaderMouseDown=b.name,b._readyToResize=1}})||(q.onHeaderMouseDown=void 0,p.remove(g,"gridxColumnResizing"));q.onHeaderCellMouseDown=q.onHeaderMouseDown}},
_mouseout:function(a){if(!this._resizing){var b=h.position(this.grid.header.domNode);if(x("chrome"))for(var c in b)b[c]=Math.floor(b[c]);if(a.clientY<=b.y||a.clientY>=b.y+b.h||a.clientX<=b.x||a.clientX>=b.x+b.w)this._readyToResize=0,p.remove(e.body(),"gridxColumnResizing")}},_mousedown:function(a){if(this._readyToResize){this._resizing=1;var b=this.grid,c=n(".gridxCell",b.header.innerNode)[0];r.setSelectable(b.domNode,!1);e.doc.onselectstart=function(){return!1};this._containerPos=h.position(b.domNode);
this._headerPos=h.position(b.header.domNode);this._padBorder=h.getMarginBox(c).w-h.getContentBox(c).w;this._initResizer();this._updateResizer(a);this._moving=0;setTimeout(function(){b.focus.blur()},0)}else this._ismousedown=1},_initResizer:function(){var a=this.grid,b=a.hScroller,c=b&&b.container.offsetHeight?b.container:a.bodyNode,b=a.header.domNode.offsetTop,c=c.parentNode.offsetTop+c.offsetHeight-a.header.domNode.offsetTop,d=this._resizer;d||(d=this._resizer=w.create("div",{className:"gridxColumnResizer"},
a.domNode,"last"),this.connect(d,"mouseup","_mouseup"));a=d.style;a.top=b+"px";a.height=c+"px";a.display="block"},_updateResizer:function(a){if(this._resizing){var b=this.grid.isLeftToRight(),c=this.arg("minWidth")+this._padBorder,d=this._cellPos;a=a.clientX;c=b?d.x+c:d.x+d.w-c;if(b?a<c:a>c)a=c;this._width=(b?a-d.x:d.x+d.w-a)-this._padBorder;this._resizer.style.left=a-this._containerPos.x-2+"px";this._moving=1}},_mouseup:function(a){this._ismousedown=0;if(this._resizing){this._resizing=this._readyToResize=
0;p.remove(e.body(),"gridxColumnResizing");r.setSelectable(this.grid.domNode,!0);e.doc.onselectstart=null;this._moving&&(this._moving=0,this.setWidth(this._targetCell.getAttribute("colid"),this._width+"px"));this._resizer.style.display="none";var b=a.clientX,c=a.clientY,d=this._headerPos;b>=d.x&&(b<=d.x+d.w&&c>=d.y&&c<=d.y+d.h)&&(a._target=this._targetCell,this._mousemove(a))}},_keydown:function(a){var b=this.grid;if((a.keyCode==l.LEFT_ARROW||a.keyCode==l.RIGHT_ARROW)&&b._isCtrlKey(a)&&a.shiftKey){var c=
a.columnId,d=n('[colid\x3d"'+b._escapeId(c)+'"].gridxCell',b.header.innerNode)[0],e=this.arg("step"),e=a.keyCode==l.LEFT_ARROW^!!b.isLeftToRight()?e:-e;this.setWidth(c,s.get(d,"width")+e);v.stop(a)}}})});
//# sourceMappingURL=ColumnResizer.js.map