//>>built
define("gridx/modules/CellWidget","dojo/_base/declare dojo/query dojo/_base/array dojo/_base/event dojo/_base/sniff dojo/dom-class dojo/keys dijit/registry dijit/a11y dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin ../core/_Module ./NavigableCell".split(" "),function(h,l,g,w,m,q,x,n,y,r,s,t,u){var v=function(){return""},p=h([r,s,t],{content:"",setCellValue:null,cell:null,postMixInProperties:function(){this.templateString=['\x3cdiv class\x3d"gridxCellWidget"\x3e',this.content,
"\x3c/div\x3e"].join("")},postCreate:function(){var a=this,b=a.domNode;a.connect(b,"onmousedown",function(c){c.target!=b&&!a.cell.column.allowEventBubble&&(c.cancelBubble=!0)});a._cellCnnts=[]},startup:function(){var a=this,b=a.cell,c=b.grid.cellWidget,d=a._started;a.inherited(arguments);g.forEach(a._cellCnnts,a.disconnect,a);d&&c.uninitializeCellWidget(a,b);c.initializeCellWidget(a,b);b=[];c.collectCellWidgetConnects(a,b);a._cellCnnts=g.map(b,function(b){return a.connect.apply(a,b)})},setValue:function(a,
b,c){try{var d=this;l(".gridxHasGridCellValue",d.domNode).map(function(a){return n.byNode(a)}).forEach(function(c){if(c){var e=q.contains(c.domNode,"gridxUseStoreData")?b:a,f=c._handleOnChange;c._handleOnChange=function(){c._handleOnChange=f};d.setCellValue||c.set("value",e)}});d.setCellValue&&d.setCellValue(a,b,d,c)}catch(e){console.error("Can not set cell value: ",e)}}});return h(u,{name:"cellWidget",required:["navigableCell"],cellMixin:{widget:function(){return this.grid.cellWidget.getCellWidget(this.row.id,
this.column.id)}},constructor:function(){this._init()},preload:function(){var a=this.grid.body;this.batchConnect([a,"onAfterRow","_showDijits"],[a,"onAfterCell","_showDijit"],[a,"onUnrender","_onUnrenderRow"])},destroy:function(){this.inherited(arguments);var a,b,c,d,e=this.grid._columns;for(a=e.length-1;0<=a;--a)if(c=e[a],d=c._cellWidgets){for(b in d)d[b].destroyRecursive();delete c._cellWidgets}},backupCount:50,setCellDecorator:function(a,b,c,d){var e=this._decorators[a];e||(e=this._decorators[a]=
{});(a=e[b])||(a=e[b]={});a.decorator=c;a.setCellValue=d;a.widget=null},restoreCellDecorator:function(a,b){var c=this._decorators[a];if(c){var d=c[b];if(d&&d.widget){var e=d.widget.domNode.parentNode;e&&(e.innerHTML=null);window.setTimeout(function(){d.widget.destroyRecursive();d.widget=null;d.decorator=null;d.setCellValue=null},100)}delete c[b]}},getCellWidget:function(a,b){var c=this.grid.body.getCellNode({rowId:a,colId:b});return c&&(c=l(".gridxCellWidget",c)[0])?n.byNode(c):null},onCellWidgetCreated:function(a,
b){b.onCellWidgetCreated&&b.onCellWidgetCreated.apply(this,arguments)},initializeCellWidget:function(a,b){var c=b.column;c.initializeCellWidget&&c.initializeCellWidget.apply(this,arguments)},uninitializeCellWidget:function(a,b){var c=b.column;c.uninitializeCellWidget&&c.uninitializeCellWidget.apply(this,arguments)},collectCellWidgetConnects:function(a,b){var c=a.cell.column;c.getCellWidgetConnects&&b.push.apply(b,c.getCellWidgetConnects(a,a.cell))},_init:function(){this._decorators={};var a,b,c=this.grid._columns;
for(a=c.length-1;0<=a;--a)b=c[a],b.widgetsInCell&&(b.userDecorator=b.decorator||v,b.decorator=this._dummyDecorator,b._cellWidgets={},b._backupWidgets=[])},_dummyDecorator:function(a,b,c,d){b=d.column;return!b.needCellWidget||b.needCellWidget(d)?"":a},_showDijits:function(a){var b=this;g.forEach(a.cells(),function(a){var d=a.column.def();if((!d.needCellWidget||d.needCellWidget(a))&&(d.userDecorator||b._getSpecialCellDec(a.row.id,d.id)))if(d=a.contentNode()){a=b._prepareCellWidget(a);if(m("ie")||m("trident"))for(;d.childNodes.length;)d.removeChild(d.firstChild);
else d.innerHTML="";a.placeAt(d);a.startup();d.setAttribute("aria-labelledby",a.id);d.removeAttribute("aria-label")}})},_showDijit:function(a){var b=a.column.def();if((!b.needCellWidget||b.needCellWidget(a))&&(b.userDecorator||this._getSpecialCellDec(a.row.id,b.id)))b=this._prepareCellWidget(a),a=a.contentNode(),a.innerHTML="",b.placeAt(a),b.startup(),a.setAttribute("aria-labelledby",b.id),a.removeAttribute("aria-label")},_prepareCellWidget:function(a){var b=a.column.def(),c=this._getSpecialWidget(a);
c||(c=b._backupWidgets.shift(),c||(c=new p({content:b.userDecorator(),setCellValue:b.setCellValue}),this.onCellWidgetCreated(c,a.column)),b._cellWidgets[a.row.id]=c);c.cell=a;c.setValue(a.data(),a.rawData(),!0);return c},_onUnrenderRow:function(a){for(var b=this.grid._columns,c=this.arg("backupCount"),d=function(a,b){var d=a._cellWidgets[b];a._backupWidgets.length<c?(d.domNode.parentNode&&d.domNode.parentNode.removeChild(d.domNode),a._backupWidgets.push(d)):d.destroyRecursive()},e=0,g=b.length;e<
g;++e){var k=b[e],f=k._cellWidgets;if(f)if(this.model.isId(a))f[a]&&(d(k,a),delete f[a]);else{for(var h in f)d(k,h);k._cellWidgets={}}}},_getSpecialCellDec:function(a,b){var c=this._decorators[a];return c&&c[b]},_getSpecialWidget:function(a){var b=this._decorators[a.row.id];if(b&&(b=b[a.column.id])){if(!b.widget&&b.decorator)try{var c=b.widget=new p({content:b.decorator(a.data(),a.row.id,a.row.visualIndex(),a),setCellValue:b.setCellValue});this.onCellWidgetCreated(c,a.column)}catch(d){console.error("Edit:",
d)}return b.widget}return null}})});
//# sourceMappingURL=CellWidget.js.map