//>>built
define("gridx/modules/ColumnWidth","dojo/_base/declare dojo/_base/array dojo/_base/Deferred ../support/query dojo/_base/sniff dojo/dom-geometry dojo/dom-class dojo/dom-style dojo/keys ../core/_Module".split(" "),function(A,n,J,m,k,t,B,C,K,D){function I(d,f,c){d.sort(function(b,c){return(b.minWidth||0)-(c.minWidth||0)});for(var a=d.length-1,b;0<=a;--a)if(b=d[a],b.minWidth&&(b.minWidth+c)*(a+1)>f)b.width=b.minWidth+"px",f-=b.minWidth+c;else break;var l=a+1;if(l){var g=Math.floor(f/l-c);f=f-(g+c)*(l-
1)-c;0>g&&(g=0);0>f&&(f=0);for(a=0;a<l;++a)b=d[a],b.width=(a?g:f)+"px"}}var v=6>k("safari")||!k("safari")&&k("webkit")&&k("ios");return A(D,{name:"columnWidth",forced:["hLayout"],constructor:function(){this._init()},load:function(){var d=this.grid;this.aspect(d.hLayout,"onUpdateWidth","_onUpdateWidth");this.aspect(d,"setColumns","_onSetColumns");this._adaptWidth();this.loaded.callback()},"default":60,autoResize:!1,onUpdate:function(){},_init:function(){var d=this,f=d.grid,c=d.arg("autoResize"),a=
d.arg("default")+"px";n.forEach(f._columns,function(b){b.hasOwnProperty("declaredWidth")||(b.declaredWidth=b.width=b.width||"auto");f.autoWidth&&("auto"==b.declaredWidth||/%$/.test(b.declaredWidth))?b.width=d["default"]<b.minWidth?b.minWidth+"px":a:c&&!/%$/.test(b.declaredWidth)&&(b.width="auto")});c&&B.add(f.domNode,"gridxPercentColumnWidth")},_onUpdateWidth:function(){var d=this.grid;if(d.autoWidth)this._adaptWidth();else{var f="none"==d.hScrollerNode.style.display,c=this.autoResize;this._adaptWidth(!f,
1);!c&&f&&m(".gridxCell",d.bodyNode).forEach(function(a){var b=d._columnsById[a.getAttribute("colId")],f=b.declaredWidth;if(c||!f||"auto"==f||/%$/.test(f))a=a.style,b=b.width,a.width=b,a.minWidth=b,a.maxWidth=b});this.onUpdate()}},_adaptWidth:function(d,f){var c=this.grid,a=c.domNode,b=c.header,l=this.arg("autoResize"),g=c.isLeftToRight(),k=g?"marginLeft":"marginRight",g=g?"marginRight":"marginLeft",u=c.hLayout.lead,p=c.hLayout.tail,w=b.innerNode,A=c.bodyNode.style,E=w.style,q=t.getBorderExtents(b.domNode).w,
x=q,H=0,r=(a.clientWidth||C.get(a,"width"))-u-p-q,h=(q=m(".gridxCell",w)[0])?t.getMarginBox(q).w-t.getContentBox(q).w:0,y=c.header.arg("groups"),B=!a.offsetHeight;this._padBorder=h;0===x?x=1:H=2;E[k]=u+"px";E[g]=(p>x?p-x:0)+"px";c.mainNode.style[k]=u+"px";c.mainNode.style[g]=p+"px";r=0>r?0:r;if(d)this.onUpdate();else{l&&v&&m(".gridxCell",w).forEach(function(e){var F=c._columnsById[e.getAttribute("colid")];if(/px$/.test(F.declaredWidth)){var b=parseInt(F.declaredWidth,10)+h,b=F.width=b+"px";e.style.width=
b;e.style.minWidth=b;e.style.maxWidth=b}});if(c.autoWidth){var z=0;m(".gridxCell",w).forEach(function(e){var b=c._columnsById[e.getAttribute("colid")],a=C.get(e,"width");if(y||!v||!B)a+=h;a<b.minWidth&&(a=b.minWidth);z+=a;if("auto"==b.width||/%$/.test(b.width))e.style.width=b.width=a+"px",e.style.minWidth=b.width,e.style.maxWidth=b.width});A.width=z+"px";a.style.width=u+p+z+H+"px"}else if(l)E.borderWidth="none"==c.vScrollerNode.style.display?0:"";else{var s=[],a=c._columns,G=0;!y&&v&&(h=0);n.forEach(a,
function(e){if("auto"==e.declaredWidth)s.push(e);else if(/%$/.test(e.declaredWidth)){var a=parseFloat(r*parseFloat(e.declaredWidth,10)/100-h,10);0>a&&(a=0);"number"==typeof e.minWidth&&a<e.minWidth&&(a=e.minWidth);var c=b.getHeaderNode(e.id);c.style.width=e.width=a+"px";c.style.minWidth=e.width;c.style.maxWidth=e.width}});n.forEach(a,function(e){if("auto"!=e.declaredWidth){var a=b.getHeaderNode(e.id),a=!y&&v?parseFloat(a.style.width,10):C.get(a,"width")+h;/%$/.test(e.declaredWidth)&&(e.width=(a>h?
a-h:0)+"px");G+=a}});if(s.length){a=r-G;if(0<a)I(s,a,h);else{var D=this.arg("default");n.forEach(s,function(b,a){var c=D;"number"==typeof b.minWidth&&c<b.minWidth&&(c=b.minWidth);b.width=c+"px"})}n.forEach(s,function(a,c){var d=b.getHeaderNode(a.id);d.style.width=a.width;d.style.minWidth=a.width;d.style.maxWidth=a.width})}}y&&(m(".gridxCell",b.innerNode).forEach(function(a){var b=c._columnsById[a.getAttribute("colid")];if(/px$/.test(b.width)){var d=a.clientWidth-t.getPadExtents(a).w;parseInt(b.width,
10)!=d&&(b.width=d+="px",a.style.width=d,a.style.minWidth=d,a.style.maxWidth=d)}}),c.autoWidth&&m(".gridxCell",c.bodyNode).forEach(function(a){var b=c._columnsById[a.getAttribute("colId")],b=b&&b.width;a=a.style;b&&(a.width=b,a.minWidth=b,a.maxWidth=b)}));c.hScroller.scroll(0);b._onHScroll(0);c.vLayout.reLayout();if(!f)this.onUpdate()}},_onSetColumns:function(){var d=this.grid;this._init();d.header._build();this._adaptWidth();d.cellWidget&&(d.cellWidget._init(),d.edit&&d.edit._init());d.tree&&d.tree._initExpandLevel();
d.body.refresh();d.header.onRender()}})});
//# sourceMappingURL=ColumnWidth.js.map