//>>built
define("gridx/modules/NestedSort","dojo/_base/declare dojo/_base/array dojo/_base/lang dojo/_base/event dojo/query dojo/string dojo/dom-class dojo/dom-construct dojo/keys ../core/_Module ../core/model/extensions/Sort ./HeaderRegions".split(" "),function(u,k,l,v,m,r,s,w,x,y,z){var n=k.filter,t=k.indexOf,q=s.remove,g=s.add;return u(y,{name:"sort",required:["headerRegions"],modelExtensions:[z],preload:function(c){var a=this;c=a.grid;a._sortData=a.arg("initialOrder",[]);if(c.persist){var b=c.persist.registerAndLoad("sort",
function(){return a._sortData});b&&(a._sortData=b)}a._sortData=n(a._sortData,function(b){return a.isSortable(b.colId)});a._sortData.length&&c.model.sort(a._sortData);a.connect(c.headerRegions,"refresh",a._updateUI);c.headerRegions.add(l.hitch(a,a._createBtn,1),10,1);c.headerRegions.add(l.hitch(a,a._createBtn,0),11,1)},columnMixin:{isSorted:function(){return this.grid.sort.isSorted(this.id)},isSortable:function(){return this.grid.sort.isSortable(this.id)}},getSortData:function(){return this._sortData},
sort:function(c){var a=this;a._sortData=n(c,function(b){return a.isSortable(b.colId)});a._doSort()},isSorted:function(c){var a=0;k.some(this._sortData,function(b){if(b.colId==c)return a=b.descending?-1:1,1});return a},isSortable:function(c){return(c=this.grid._columnsById[c])&&(c.sortable||void 0===c.sortable)},clear:function(){this._sortData.length=0;this._doSort()},_createBtn:function(c,a){var b=this,d=b.grid.nls;if(b.isSortable(a.id)){var e=w.create("div",{"class":"gridxSortBtn gridxSortBtn"+(c?
"Single":"Nested"),tabIndex:-1,title:c?d.singleSort+" - "+d.ascending:d.nestedSort+" - "+d.ascending,innerHTML:c?'\x3cspan class\x3d"gridxNestedSortBtnText"\x3e\x26#1784;\x3c/span\x3e\x26nbsp;':b._sortData.length+1+'\x3cspan class\x3d"gridxNestedSortBtnText"\x3e\x26#1784;\x3c/span\x3e'});b.connect(e,"onmousedown",function(){b._sort(a,e,c)});b.connect(e,"onkeydown",function(d){d.keyCode==x.ENTER&&(v.stop(d),b._sort(a,e,c))});return e}},_sort:function(c,a,b){a=this._sortData;b?(1<a.length&&(a.length=
0),b=n(a,function(a){return a.colId===c.id})[0],a.length=0,b&&a.push(b)):b=n(a,function(a){return a.colId===c.id})[0];b?(b.descending&&a.splice(t(a,b),1),b.descending=!b.descending):(b={colId:c.id,descending:!1},a.push(b));this._doSort()},_doSort:function(){var c=this.grid,a=this._sortData;this._updateUI();c.model.sort(a.length?a:null);c.body.refresh()},_updateUI:function(){var c=this,a=c.grid,b=a.nls,d=a.domNode,e=k.filter(c._sortData,function(b){return a._columnsById[b.colId]});q(d,"gridxSingleSorted");
q(d,"gridxNestedSorted");1==e.length?g(d,"gridxSingleSorted"):1<e.length&&g(d,"gridxNestedSorted");m(".gridxCell",a.header.domNode).forEach(function(a){var d=a.getAttribute("colid");if(c.isSortable(d)){k.forEach(["","Desc","Asc","Main"],function(b){q(a,"gridxCellSorted"+b)});var h=m(".gridxSortBtnSingle",a)[0],f=m(".gridxSortBtnNested",a)[0];h.title=b.singleSort+" - "+b.ascending;f.title=b.nestedSort+" - "+b.ascending;h.innerHTML='\x3cspan class\x3d"gridxNestedSortBtnText"\x3e\x26#1784;\x3c/span\x3e\x26nbsp;';
f.innerHTML=e.length+1+'\x3cspan class\x3d"gridxNestedSortBtnText"\x3e\x26#1784;\x3c/span\x3e';var p=n(e,function(a){return a.colId===d})[0];c._setWaiState(a,d,p);if(p){f.innerHTML=t(e,p)+1;g(a,"gridxCellSorted");p==e[0]&&g(a,"gridxCellSortedMain");var l=e.length;p.descending?(g(a,"gridxCellSortedDesc"),1==l?(h.title=b.singleSort+" - "+b.unsorted,h.innerHTML='\x3cspan class\x3d"gridxNestedSortBtnText"\x3e\x26#9662;\x3c/span\x3e\x26nbsp;'):(f.title=b.nestedSort+" - "+b.unsorted,f.innerHTML+='\x3cspan class\x3d"gridxNestedSortBtnText"\x3e\x26#9662;\x3c/span\x3e')):
(g(a,"gridxCellSortedAsc"),1==l?(h.title=b.singleSort+": "+b.descending,h.innerHTML='\x3cspan class\x3d"gridxNestedSortBtnText"\x3e\x26#9652;\x3c/span\x3e\x26nbsp;'):(f.title=b.nestedSort+" - "+b.descending,f.innerHTML+='\x3cspan class\x3d"gridxNestedSortBtnText"\x3e\x26#9652;\x3c/span\x3e'))}}})},_setWaiState:function(c,a,b){a="Column "+this.grid.column(a).name();var d="none",e="ascending";b&&(d=b.descending?"descending":"ascending",e=b.descending?"none":"descending");b=r.substitute(this.grid.nls.waiSingleSortLabel,
[a,d,e]);a=r.substitute(this.grid.nls.waiNestedSortLabel,[a,d,e]);m(".gridxSortBtnSingle",c)[0].setAttribute("aria-label",b);m(".gridxSortBtnNested",c)[0].setAttribute("aria-label",a)}})});
//# sourceMappingURL=NestedSort.js.map