//>>built
define("gridx/core/model/Model","require dojo/_base/declare dojo/_base/array dojo/_base/lang dojo/_base/Deferred dojo/DeferredList dojo/aspect dojo/store/Memory dojo/store/JsonRest ./cache/Sync ./cache/Async".split(" "),function(q,u,h,k,m,v,p,y,z,w,A){function r(a){return a||0===a}function l(a){return"number"==typeof a&&0<=a}function x(a,c){var b,d=[],e=[],f={range:d,id:e},g=function(a){if(a&&l(a.start))d.push(a);else if(l(a))d.push({start:a,count:1});else if(s(a))for(b=a.length-1;0<=b;--b)l(a[b])?
d.push({start:a[b],count:1}):a[b]&&l(a[b].start)?d.push(a[b]):t(a)&&e.push(a[b]);else t(a)&&e.push(a)};if(c&&(c.index||c.range||c.id))if(g(c.index),g(c.range),s(c.id))for(b=c.id.length-1;0<=b;--b)e.push(c.id[b]);else r(c.id)&&e.push(c.id);else g(c);!d.length&&(!e.length&&0>a.size())&&d.push({start:0,count:a._cache.pageSize||1});return f}var s=k.isArrayLike,t=k.isString;return u([],{constructor:function(a){var c=a.cacheClass||w,c="string"==typeof c?q(c):c;this.store=a.store;this._exts={};this._cmdQueue=
[];this._model=this._cache=new c(this,a);this._createExts(a.modelExtensions||[],a);a=this._model;this._cnnts=[p.after(a,"onDelete",k.hitch(this,"onDelete"),1),p.after(a,"onNew",k.hitch(this,"onNew"),1),p.after(a,"onSet",k.hitch(this,"onSet"),1)]},destroy:function(){h.forEach(this._cnnts,function(a){a.remove()});for(var a in this._exts)this._exts[a].destroy();this._cache.destroy()},clearCache:function(){this._cache.clear()},isId:r,setStore:function(a){this.store=a;this._cache.setStore(a)},when:function(a,
c,b){this._oldSize=this.size();this._addCmd({name:"_cmdRequest",scope:this,args:arguments,async:1});return this._exec()},scan:function(a,c){var b=new m,d=a.start||0,e=a.pageSize||this._cache.pageSize||1,f=a.count,g=0<f?d+f:Infinity,n=a.whenScope||this,k=a.whenFunc||n.when,h=function(a){b.progress(a/(0<f?a+f:n.size()));k.call(n,{id:[],range:[{start:a,count:e}]},function(){var b,d,f=[];for(b=a;b<a+e&&b<g;++b)if(d=n.byIndex(b))f.push(d);else{g=-1;break}if(c(f,a)||b==g)g=-1}).then(function(){-1==g?b.callback():
h(a+e)})};h(d);return b},onDelete:function(){},onNew:function(){},onSet:function(){},onSizeChange:function(){},_msg:function(){},_addCmd:function(a){var c=this._cmdQueue,b=c[c.length-1];b&&b.name==a.name&&b.scope==a.scope?b.args.push(a.args||[]):(a.args=[a.args||[]],c.push(a))},_onSizeChange:function(){var a=this._oldSize,c=this._oldSize=this.size();if(a!=c)this.onSizeChange(c,a)},_cmdRequest:function(){var a=this;return new v(h.map(arguments,function(c){var b=c[0],d=function(){a._onSizeChange();
c[1]&&c[1].call(c[2])};return null===b||!c.length?(b=new m,d(),b.callback(),b):a._model._call("when",[x(a,b),d])}),0,1)},_exec:function(){var a=this,c=a._cache,b=new m,d=a._cmdQueue,e=function(b,d){a._busy=0;c._checkSize&&c._checkSize();d?b.errback(d):b.callback()},f=function(){if(h.some(d,function(a){return"_cmdRequest"==a.name}))try{for(;d.length;){var a=d.shift(),c=a.scope[a.name].apply(a.scope,a.args);if(a.async){m.when(c,f,k.partial(e,b));return}}}catch(l){e(b,l);return}e(b)};if(a._busy)return a._busy;
a._busy=b;f();return b},_createExts:function(a,c){a=h.filter(h.map(a,function(a){return"string"==typeof a?q(a):a}),function(a){return a&&a.prototype});a.sort(function(a,b){return a.prototype.priority-b.prototype.priority});for(var b=0,d=a.length;b<d;++b)if(b==a.length-1||a[b]!=a[b+1]){var e=new a[b](this,c);this._exts[e.name]=e}}})});
//# sourceMappingURL=Model.js.map